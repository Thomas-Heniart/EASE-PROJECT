var tagManager,TagManager=function(e){var t=this;this.rootEl=e,this.tags=[],this.tagWebsites=[],this.selectedWebsites=[],this.catalogWebsites=[],this.currentTag=null,this.tagsRow=$("#tags",t.rootEl),this.tagWebsitesRow=$("#tag-websiteList",t.rootEl),this.tagSettingsRow=$("#tag-settings",t.rootEl),this.selectedColor=$(".tag-settings-color-selected",t.tagSettingsRow),this.tagColorsRow=$(".tag-settings-colors",t.tagSettingsRow),this.catalogWebsitesRow=$("#catalogWebsites",t.rootEl),this.loadTags=function(){postHandler.post("GetTags",{},function(){t.tags.forEach(function(e){e.removeFromDocument()}),t.tags=[]},function(e){json=JSON.parse(e),json.forEach(function(e){t.addTag(e)})},function(e){})},this.addCatalogWebsite=function(e){var s=new CatalogWebsite(t.catalogWebsitesRow,e.name,e.imgSrc,e.isTagged,e.single_id);t.catalogWebsites.push(s),s.printOnDocument(),s.onClick(function(){var e=t.selectedWebsites.indexOf(s);-1==e?t.selectedWebsites.push(s):t.selectedWebsites.splice(e,1),s.toggleSelect()})},this.loadCatalogWebsites=function(){postHandler.post("GetCatalog",{},function(){},function(e){JSON.parse(e).forEach(function(e){t.addCatalogWebsite(e)})},function(e){})},this.addTag=function(e){var s=new Tag(t.tagsRow,e.name,e.color,e.colorId,e.single_id);return t.tags.push(s),s.printOnDocument(),s.onClick(function(){t.currentTag=s,t.loadTagWebsites(),$("#AddTagMode",t.tagSettingsRow).removeClass("active"),$("#tag-settings-editName",t.tagSettingsRow).val(e.name),t.selectedColor.css("background-color",e.color),t.selectedColor.attr("index",e.colorId),t.selectedColor.text(e.color),$("#tag-delete",t.tagSettingsRow).removeClass("hide")}),s},this.loadTagWebsites=function(){t.tagWebsitesRow.addClass("hidden"),postHandler.post("GetTagWebsites",{single_id:t.currentTag.single_id},t.emptyTagWebsites,function(e){var s=JSON.parse(e);t.emptySelectedWebsites(),s.forEach(function(e){t.addTagWebsite(e);var s=t.catalogWebsites.find(function(t){return t.single_id==e.single_id});s.select(),t.selectedWebsites.push(s)}),setTimeout(function(){t.tagWebsitesRow.removeClass("hidden")},300)},function(e){})},this.emptyTagWebsites=function(){t.tagWebsites.forEach(function(e){e.removeFromDocument()}),t.tagWebsites=[]},this.emptySelectedWebsites=function(){t.selectedWebsites.forEach(function(e){e.unselect()}),t.selectedWebsites=[]},this.addTagWebsite=function(e){var s=new TagWebsite(t.tagWebsitesRow,e.single_id,e.name,e.imgSrc);t.tagWebsites.push(s),s.printOnDocument()},this.updateCatalogWebsites=function(){t.tags.forEach()},t.selectedColor.click(function(){t.tagColorsRow.toggleClass("show")}),$("#addTagWebsite",t.rootEl).click(function(){t.catalogWebsitesRow.toggleClass("hidden")}),$("#AddTagMode",t.tagSettingsRow).click(function(){$(this).addClass("active"),$("#tag-delete",t.tagSettingsRow).addClass("hide"),$("#tag-settings-editName",t.tagSettingsRow).val(""),t.catalogWebsitesRow.removeClass("hidden"),t.tagColorsRow.toggleClass("show"),t.currentTag=null}),$("#tag-delete",t.tagSettingsRow).click(function(){var e=t.tags.indexOf(t.currentTag);-1!=e&&(t.currentTag.remove(),t.tags.splice(e,1),t.emptyTagWebsites(),t.currentTag=null,$(this).addClass("hide"))}),$(".tag-settings-color",t.tagColorsRow).click(function(){t.selectedColor.css("background-color",$(this).css("background-color")),t.selectedColor.attr("index",$(this).attr("index")),t.selectedColor.text($(this).text()),t.tagColorsRow.removeClass("show")}),$("#tag-settings-submit",t.tagSettingsRow).click(function(){var e=$("#tag-settings-editName",t.tagSettingsRow).val(),s=t.selectedColor.attr("index"),o=t.selectedWebsites.map(function(e){return e.single_id.toString()}),i=JSON.stringify(o);null!=t.currentTag?postHandler.post("EditTag",{single_id:t.currentTag.single_id,name:e,colorId:s,websiteIds:i},function(){},function(s){t.currentTag.setName(e),t.currentTag.setColor(t.selectedColor.css("background-color"),t.selectedColor.attr("index")),t.loadTagWebsites()},function(e){}):postHandler.post("AddTag",{name:e,colorId:s,websiteIds:i},function(){},function(e){var s=JSON.parse(e);t.currentTag=t.addTag(s),$("#tag-delete",t.tagSettingsRow).removeClass("hide"),t.loadTagWebsites()},function(e){})})},Tag=function(e,t,s,o,i){var n=this;this.rootEl=e,this.name=t,this.color=s,this.colorId=o,this.single_id=i,this.elem=null,this.websites=[],this.printOnDocument=function(){n.elem=$("<span class='tag ease-button hvr-grow' style='background-color: "+n.color+";'><span>"+n.name+"</span></span>").appendTo(n.rootEl)},this.remove=function(){postHandler.post("DeleteTag",{single_id:n.single_id},function(){},function(e){n.removeFromDocument()},function(e){})},this.onClick=function(e){n.elem.click(e)},this.removeFromDocument=function(){n.elem.remove()},this.setColor=function(e,t){n.color=e,n.colorId=t,n.elem.css("background-color",e)},this.setName=function(e){n.name=s,$("span",n.elem).text(e)}},TagWebsite=function(e,t,s,o){var i=this;this.rootEl=e,this.single_id=t,this.imgSrc=o,this.name=s,this.elem=null,this.printOnDocument=function(){i.elem=$("<div class='website'><div class='logo'><img src='"+i.imgSrc+"' /></div><p>"+i.name+"</p></div>").prependTo(i.rootEl)},this.removeFromDocument=function(){i.elem.remove()},this.remove=function(){}},CatalogWebsite=function(e,t,s,o,i){var n=this;this.rootEl=e,this.name=t,this.elem=null,this.imgSrc=s,this.single_id=i,this.selected=!1,this.isTagged=o,this.printOnDocument=function(){n.elem=$("<div class='website"+(n.isTagged?"":" untagged")+"'><div class='logo'><img class='websiteImg' src='"+n.imgSrc+"' /><img class='tick' src='resources/icons/checked.png' /><span class='untagged'></span></div><p>"+n.name+"</p></div>").appendTo(n.rootEl)},this.onClick=function(e){n.elem.click(e)},this.select=function(){n.elem.addClass("selected"),n.selected=!0},this.unselect=function(){n.elem.removeClass("selected"),n.selected=!1},this.toggleSelect=function(){n.selected=!n.selected,n.elem.toggleClass("selected")},this.beUntagged=function(){n.isTagged=!1,n.elem.removeClass("tagged")},this.beTagged=function(){n.isTagged=!0,n.elem.addClass("tagged")}};$(document).ready(function(){tagManager=new TagManager($("#TagsManagerTab")),tagManager.loadTags(),tagManager.loadCatalogWebsites()});