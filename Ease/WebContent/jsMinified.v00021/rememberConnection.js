function getCurrentUser(){return 0==extension.nbOfEaseTabs()?"anonymous":lastEaseUser}function printLastConnections(){extension.storage.get("lastConnections",function(e){console.log(e)})}function printAllConnections(){extension.storage.get("allConnections",function(e){console.log(e)})}function rememberConnection(e,n,o,t){extension.storage.get("lastConnections",function(s){s||(s={}),s[o]={user:e},console.log("-- Connection for email "+e+" on website "+o+" remembered --"),extension.storage.set("lastConnections",s,function(){}),t||rememberEveryConnections({user:e,password:n,website:o})})}function rememberDirectLogWithConnection(e,n){extension.storage.get("lastConnections",function(o){o||(o={}),o[e]=n,console.log("-- Connection with "+n+" on website "+e+" remembered --"),extension.storage.set("lastConnections",o,function(){}),n.website=e})}function rememberLogWithConnection(e,n){extension.storage.get("lastConnections",function(o){o||(o={}),o[n]&&(o[e]=o[n].user?{user:o[n].user,logWith:n}:{user:o[n],logWith:n}),console.log("-- Connection with "+n+" on website "+e+" remembered --"),extension.storage.set("lastConnections",o,function(){}),rememberEveryConnections({user:o[e].user,logWith:n,website:e})})}function rememberEveryConnections(e){var n=new Date,o=getCurrentUser();e.expiration=n.getTime()+6048e5,extension.storage.get("allConnections",function(n){void 0==n[o]&&(n[o]={}),void 0==n[o][e.user]&&(n[o][e.user]={}),e.logWith?(n[o][e.user][e.website]={logWith:e.logWith,expiration:e.expiration},extension.storage.set("allConnections",n,function(){"anonymous"!=o&&null!=lastEaseTab&&extension.tabs.sendMessage(lastEaseTab,"SendUpdate",e,function(){})})):encryptPassword(e.password,function(t){n[o][e.user][e.website]={password:t.password,expiration:e.expiration,keyDate:t.keyDate},extension.storage.set("allConnections",n,function(){"anonymous"!=o&&null!=lastEaseTab&&extension.tabs.sendMessage(lastEaseTab,"SendUpdate",e,function(){})})})})}function cleanEveryConnections(){extension.storage.get("allConnections",function(e){if((void 0==e||null==e||!e.validator&&!e.newValidator)&&(e={validator:"ok"}),e.newValidator)var n=e;else{var n={newValidator:"ok"};n.anonymous=e}for(var o in n){for(var t in n[o]){for(var s in n[o][t])n[o][t][s].expiration<(new Date).getTime()&&delete n[o][t][s];jQuery.isEmptyObject(n[o][t])&&delete n[o][t]}jQuery.isEmptyObject(n[o])&&delete n[o]}extension.storage.set("allConnections",n,function(){})}),setTimeout(cleanEveryConnections,144e5)}function matchFacebookUrl(e){return-1!=e.indexOf("www.facebook.com")&&e.indexOf("www.facebook.com")<10?!0:!1}function matchFacebookConnectUrl(e){return-1==e.indexOf("facebook")||matchFacebookUrl(e)?!1:!0}function matchLinkedinUrl(e){return-1!=e.indexOf("www.linkedin.com")&&e.indexOf("www.linkedin.com")<10?!0:!1}function matchLinkedinConnectUrl(e){return-1!=e.indexOf("linkedin")&&(e.indexOf("www.linkedin.com")>10||e.indexOf("www.linkedin.com")<0)?!0:!1}function getHost(e){var n=function(e){var n=document.createElement("a");return n.href=e,n};return n(e).hostname}function equalArrays(e,n){if(n.length!=e.length)return!1;for(var o=0,t=n.length;t>o;o++)if(n[o]instanceof Array&&e[o]instanceof Array){if(!n[o].equals(e[o]))return!1}else if(n[o]!=e[o])return!1;return!0}cleanEveryConnections();var lastEaseUser="",lastEaseUserNotAnonymous="",lastEaseTab=null;extension.runtime.bckgrndOnMessage("ChangeEaseUser",function(e,n){console.log("-- Current ease user : "+e.user+" --"),lastEaseUser=e.user,"anonymous"!=lastEaseUser&&lastEaseUser!=lastEaseUserNotAnonymous?(extension.storage.set("visitedWebsites",[],function(){}),lastEaseUserNotAnonymous=lastEaseUser,console.log("-- Current ease user : "+lastEaseUserNotAnonymous+" --")):"anonymous"==lastEaseUser&&console.log("-- Disconnected from Ease --"),lastEaseTab=n}),extension.runtime.bckgrndOnMessage("GetEaseUser",function(){sendResponse(getCurrentUser())}),extension.runtime.bckgrndOnMessage("GetLastEaseUser",function(){sendResponse(lastEaseUserNotAnonymous)}),extension.runtime.bckgrndOnMessage("newConnectionToRandomWebsite",function(e){rememberConnection(e.username,e.password,e.website,!1)}),extension.runtime.bckgrndOnMessage("fbDisconnected",function(){rememberConnection("disconnected","","www.facebook.com",!0)});