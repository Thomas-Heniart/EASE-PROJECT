function addTeamRow(e){var a=$("<tr><td>"+e.id+"</td><td>"+e.name+"</td><td>"+e.admin_first_name+"</td><td>"+e.admin_last_name+"</td><td>"+e.admin_email+"</td><td>"+e.team_users_size+"</td><td>"+e.active_team_users+"</td><td>"+e.phone_number+"</td><td><a href='#'><i class='fa fa-cog'></i></a></td></tr>");return e.is_active||a.addClass("negative"),$("a",a).click(function(){openTeamSettings(e,a)}),a}function addWebsiteRow(e){var a=$('<tr><td class="id">'+e.id+'</td><td class="name">'+e.name+'</td><td class="logo"><img class="ui mini image" src="'+e.logo+'" /> </td><td class="login_url">'+e.login_url+'</td><td class="landing_url">'+e.landing_url+'</td><td> <div class="ui checkbox public"><input type="checkbox"/><label></label></div></td><td><a href="#"><i class="fa fa-pencil edit-website"/></a></td><td> <div class="ui checkbox delete"><input type="checkbox"/><label></label></div></td><td><a href="#" class="merge-website">Merge</a></td></tr>');return e.integrated||a.addClass("negative"),e.public||($(".public",a).addClass("checked"),$(".public input",a).prop("checked",!0)),$(".public input",a).click(function(){var a=$(this).is(":checked");ajaxHandler.post("/api/v1/admin/ToggleWebsiteVisibility",{id:e.id,private:a})}),$(".edit-website",a).click(function(){openWebsiteIntegration(e,a)}),$(".merge-website",a).click(function(){openWebsiteMerging(e,a)}),a}function openWebsiteIntegration(e,a){var i=$("#website-integration"),t=$("#website-edition",i),n=$("input[name='name']",t),d=$("input[name='login_url']",t),s=$("input[name='landing_url']",t),l=$("input[name='folder']",t),o=$("#integration input[name='integrate']",t);$("#website-upload input[name='website_id']",i).val(e.id),n.val(e.name),d.val(e.login_url),s.val(e.landing_url),l.val(e.folder),e.integrated&&($("#integration",t).addClass("checked"),o.prop("checked",!0)),e.teams.forEach(function(e){$(".teams .item[data-value='"+e.id+"']",i).click()}),$(".sso .item[data-value='"+e.sso+"']",i).click(),t.submit(function(r){r.stopPropagation(),r.preventDefault();var c=$(this).attr("action"),u=[];""!==$("input[name='team_id']",i).val()&&(u=$("input[name='team_id']",i).val().split(",").map(parseInt));var m=$("input[name='sso_id']",i).val();ajaxHandler.post(c,{id:e.id,name:n.val(),landing_url:s.val(),login_url:d.val(),folder:l.val(),integrated:o.is(":checked"),teams:u,sso_id:m},function(){},function(){e.name=n.val(),e.landing_url=s.val(),e.login_url=d.val(),e.folder=l.val(),e.integrated=o.is(":checked"),u=u.map(function(e){return{id:e,name:$(".teams .item[data-value='"+e+"']",i).text()}}),e.sso=""!==m?parseInt(m):-1,e.teams=u,e.integrated||a.addClass("negative"),$(".name",a).text(e.name),$(".landing_url",a).text(e.landing_url),$(".login_url",a).text(e.login_url),$(".logo img",a).attr("src","/resources/websites/"+e.folder+"/logo.png")}),t.off("submit"),i.modal("hide")}),i.modal({onHide:function(){t.off("submit"),$("input[name='team_id']",i).val(""),$("a.ui.label.transition",i).remove(),$(".item.active").removeClass("active").removeClass("filtered"),$("input.search").val("")}}).modal("show")}function openWebsiteMerging(e,a){var i=$("#website-merging");$(".form button",i).click(function(){ajaxHandler.post("/api/v1/admin/MergeWebsite",{id:$("input[name='website_id']",i).val(),id_to_merge:e.id},function(){},function(){$(".item[data-value='"+e.id+"']").remove(),a.remove(),i.modal("hide")})}),i.modal({onHide:function(){$(".form button",i).off("click")}}).modal("show")}function addResult(e){return $("<div class='item' data-value='"+e.id+"'><img class='ui avatar image' src='"+e.logo+"' />"+e.name+"</div>")}function openTeamSettings(e,a){var i=$("#team-settings"),t=$("#send-money",i);$("#current-credit",i).text(e.credit),$("#card-number span",i).text(e.card_number),$("#link-number span",i).text(e.link_number),$("#single-number span",i).text(e.single_number),$("#enterprise-number span",i).text(e.enterprise_number),$("#card-with-password-reminder span",i).text(e.card_with_password_reminder),$("i",t).click(function(a){if(!t.hasClass("loading")){var n=$("input",t).val();if(-1===n.indexOf("."))n=100*parseInt(n);else{var d=n.split(".")[0],s=n.split(".")[1];1===s.length&&(s+="0"),n=100*parseInt(d)+parseInt(s)}t.addClass("loading"),t.addClass("disabled"),ajaxHandler.post("/api/v1/admin/SendLoveMoney",{team_id:e.id,credit:n},function(){},function(e){$("#current-credit",i).text(e.credit),$("input",t).val(""),t.removeClass("loading"),t.removeClass("disabled")})}}),i.modal({onHide:function(){$("i",t).off("click"),$("input",t).val("")}}).modal("show")}$(document).ready(function(){$(".ui.checkbox").checkbox(),$(".ui.dropdown").dropdown(),$(".ui.menu a.item").on("click",function(){$(this).addClass("active").siblings().removeClass("active");var e=$($(this).attr("data-target"));if($(".segment").hide(),e.show(),e.hasClass("loading"))switch(e.attr("id")){case"team-segment":ajaxHandler.get("/api/v1/admin/GetTeamsInformation",null,function(){},function(a){a.forEach(function(e){addTeamRow(e).appendTo($("#team-manager-body"))}),e.removeClass("loading")});break;case"website-segment":ajaxHandler.get("/api/v1/admin/GetTeams",null,function(){},function(e){e.forEach(function(e){$("<div class='item' data-value='"+e.id+"'>"+e.name+"</div>").appendTo($("#website-edition .teams .menu"))})}),ajaxHandler.get("/api/v1/admin/GetSso",null,function(){},function(e){e.forEach(function(e){$("<div class='item' data-value='"+e.id+"'>"+e.name+"</div>").appendTo($("#website-edition .sso .menu"))})}),ajaxHandler.get("/api/v1/admin/GetWebsites",null,function(){},function(a){websites=a,websites.forEach(function(e){addWebsiteRow(e).appendTo($("#website-manager-body")),addResult(e).appendTo($("#website-merging .menu"))}),e.removeClass("loading")})}})});