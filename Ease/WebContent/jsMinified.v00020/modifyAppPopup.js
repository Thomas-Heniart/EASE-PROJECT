var EditInput=function(t,e,n,s,o,a,i){var r=this;if(this.qRoot=$(t),this.name=n,this.value=o,this.qRoot.append('<span class="input '+n+'"><i class="fa '+i+' placeholderIcon" aria-hidden="true"></i></span>'),"password"===s&&$("span.input."+n,this.qRoot).append('<div class="showPassDiv"><i class="fa fa-eye centeredItem" aria-hidden="true"></i><i class="fa fa-eye-slash centeredItem" aria-hidden="true"></i></div><div class="inputUnlocker"><i class="fa fa-cog centeredItem" aria-hidden="true"></i></div>'),$("span.input."+n,this.qRoot).append('<input readonly autocomplete="new-password" type="'+s+'" name="'+n+'" id="'+n+'" value="'+o+'" placeholder="'+a+'"/>'),"password"===s){var p=$("span.input."+n,this.qRoot);$("input",p).attr("placeholder","click the wheel to update"),$(".inputUnlocker",p).click(function(){e.unlockPasswordInput(p)}),p.addClass("locked")}this.inputField=$("#"+n,this.qRoot),this.inputField.one("focus",function(){$(this).prop("readonly",!1)}),this.inputField.keyup(function(t){13==t.which&&e.tabInfoSubmitButton.click()}),this.val=function(){return r.inputField.val()}};modifyAppPopup=function(t){var e=this;this.qRoot=$(t),this.parentHandler=this.qRoot.closest("#easePopupsHandler"),this.goBackButtonHandler=this.qRoot.find("#goBack"),this.appNameHolder=this.qRoot.find("input#appName"),this.appLogoHandler=this.qRoot.find("#appLogo img"),this.urlInputHandler=this.qRoot.find("input[name='url']"),this.urlRow=this.qRoot.find(".urlRowHandler"),this.tabInfo=this.qRoot.find("#tabInfo"),this.tabInfoErrorRowHandler=this.tabInfo.find(".errorHandler"),this.tabInfoSubmitButton=this.tabInfo.find("button[type='submit']"),this.loginPasswordRow=this.tabInfo.find(".loginPasswordRow"),this.qRoot.find(".row.fragmentsRow").tabs({show:{effect:"fadeIn",duration:300}}),this.signInChooseRow=this.tabInfo.find(".signInChooseRow"),this.signInAccountSelectRow=this.tabInfo.find(".signInAccountSelectRow"),this.signInDetectionErrorHandler=this.signInAccountSelectRow.find(".SignInErrorHandler"),this.sameSsoAppsRow=this.tabInfo.find(".sameSsoAppsRow"),this.sameSsoAppsObjectHandler=this.sameSsoAppsRow.find(".selectHandler"),this.signInAccountSelectRow.find(".selectable").selectable({classes:{"ui-selected":"selected"}}),this.signInButtons=[],this.choosenSignInName="",this.basicSignInName="",this.lockPasswordInput=function(t){},this.unlockPasswordInput=function(t){t.removeClass("locked"),t.find("input").attr("placeholder","Password"),t.find("input").focus(),e.tabInfoSubmitButton.addClass("locked")},this.signInChooseRow.find(".signInButton").each(function(t,n){var s={};s.name=$(n).attr("data"),s.qRoot=$(n),s.qRoot.click(function(){if(!$(this).hasClass("selected")){e.signInChooseRow.find(".selected").removeClass("selected"),$(this).addClass("selected"),e.loginPasswordRow.addClass("hide");var t=catalog.getAppByName($(this).attr("data"));e.choosenSignInName=$(this).attr("data"),e.signInDetectionErrorHandler.removeClass("show"),e.signInDetectionErrorHandler.find("span").text(e.choosenSignInName),e.showSignInAccounts(t.id)}}),e.signInButtons.push(s)}),this.createSignInSelectorDiv=function(t){return $('<div class="accountLine" appId='+t.id+'><div class="checkBoxInput"><span class="fa-stack"><i class="fa fa-square-o fa-stack-2x"></i><i class="fa fa-check fa-stack-1x"></i></span></div><p class="accountName">'+t.getAccountInformationValue("login")+"</p></div>")},this.showSignInButtons=function(t){e.signInChooseRow.find(".signInButton").removeClass("show");for(var n,s=0;s<t.length;s++)n=catalog.getAppById(t[s]).name,e.signInChooseRow.find(".signInButton[data="+n+"]").addClass("show")},this.showSignInAccounts=function(t){var n=e.signInAccountSelectRow.find(".accountsHolder");n.find(".accountLine").remove();for(var s,o=easeAppsManager.getAppsByWebsiteIdNotEmpty(t),a=0;a<o.length;a++)s=e.createSignInSelectorDiv(o[a]),o[a].id==e.currentApp.logWith?(s.addClass("selected"),s.addClass("ui-selected"),s.addClass("ui-selectee")):e.choosenSignInName==e.basicSignInName||a||(s.addClass("selected"),s.addClass("ui-selected"),s.addClass("ui-selectee")),n.append(s);o.length?e.tabInfoSubmitButton.removeClass("locked"):(e.tabInfoSubmitButton.addClass("locked"),e.signInDetectionErrorHandler.addClass("show")),e.signInAccountSelectRow.removeClass("hide")},this.sameSsoAccountsVar=[],this.createSameAccountDiv=function(t,e){return $('<div class="appHandler"><div class="appLogo"><img src="'+t+'"></div><div class="appName"><p>'+e+"</p></div></div>")},this.setupSameSsoAccountsDiv=function(){var t,n=easeAppsManager.getAppsByLoginAndSsoId(e.currentApp.getAccountInformationValue("login"),e.currentApp.ssoId);n.splice(n.indexOf(e.currentApp),1);for(var s=0;s<n.length;s++)(t={}).app=n[s],t.qRoot=e.createSameAccountDiv(n[s].imgSrc,n[s].name),e.sameSsoAccountsVar.push(t),e.sameSsoAppsObjectHandler.append(t.qRoot)},this.resetSameAccountsRow=function(){for(var t=0;t<e.sameSsoAccountsVar.length;t++)e.sameSsoAccountsVar[t].qRoot.remove();this.sameSsoAccountsVar=[]},this.tabDelete=this.qRoot.find("#tabDelete"),this.tabDeleteErrorRowHandler=this.tabDelete.find(".errorHandler"),this.tabDeleteSubmitButton=this.tabDelete.find("button[type='submit']"),this.tabDeleteSubmitButton.click(function(){e.tabDeleteErrorRowHandler.removeClass("show"),e.tabDeleteSubmitButton.addClass("loading"),postHandler.post("RemoveApp",{appId:e.currentApp.id},function(){e.tabDeleteSubmitButton.removeClass("loading")},function(t){e.currentApp.currentProfile.removeApp(e.currentApp),e.relatedCatalogApp&&e.relatedCatalogApp.decreaseCount(),e.currentApp.remove(),e.close()},function(t){e.tabDeleteErrorRowHandler.find("p").text(t),e.tabDeleteErrorRowHandler.addClass("show")},"text")}),this.currentApp=null,this.relatedCatalogApp=null,this.currentInputs=[],this.resetSimpleInputs=function(){},this.resetPasswordShows=function(){e.qRoot.find("input[name='password']").attr("type","password"),e.qRoot.find(".showPassDiv.show").removeClass("show")},this.resetSignInAccounts=function(){e.signInAccountSelectRow.find(".accountLine").remove(),e.signInDetectionErrorHandler.removeClass("show"),e.signInChooseRow.find(".selected").removeClass("selected")},this.tabInfoSubmitButton.click(function(){e.tabInfoErrorRowHandler.removeClass("show"),e.tabInfoSubmitButton.addClass("loading");var t=e.appNameHolder.val(),n=e.urlInputHandler.val(),s=e.signInAccountSelectRow.find(".selected"),o=s.length?$(s[0]).attr("appid"):"",a=[];a.push(e.currentApp.id.toString());for(d=0;d<e.sameSsoAccountsVar.length;d++)a.push(e.sameSsoAccountsVar[d].app.id.toString());var i=null,r="EditClassicApp";e.currentApp.logWith.length?(r="EditLogwithApp",i="LogwithApp"):e.currentApp.url.length&&(r="EditBookMark"),e.currentApp.isEmpty&&(o.length?(r="WebsiteAppToLogwithApp",i="LogwithApp"):(r="WebsiteAppToClassicApp",i="ClassicApp"));for(var p=JSON.stringify(a),l={name:t,logwithId:o,link:n,appIds:p},c=[],d=0;d<e.currentInputs.length;d++){var u=e.currentInputs[d];if(l[u.name]=u.val(),"password"!=u.name){var h={};h.name=u.name,h.value=u.val(),c.push(h)}}postHandler.post(r,l,function(){e.tabInfoSubmitButton.removeClass("loading")},function(s){if(e.currentApp.changeName(t),e.currentApp.url=n,e.currentApp.isEmpty&&(e.currentApp.qRoot.find(".emptyAppIndicator").remove(),e.currentApp.qRoot.removeClass("emptyApp"),e.currentApp.isEmpty=!1),l.login!=e.currentApp.getAccountInformationValue("login")||l.password.length)for(var a=0;a<e.sameSsoAccountsVar.length;a++)e.sameSsoAccountsVar[a].app.setAccountInformationValue("login",l.login),e.sameSsoAccountsVar[a].app.scaleAnimate();e.currentApp.accountInformations=c,e.currentApp.logWith=o,i&&(e.currentApp.type=i,"LogwithApp"===i&&(e.currentApp.logWithName=catalog.getAppById(easeAppsManager.getAppById(o).websiteId).name),e.currentApp.setupAppTypeIndicator()),e.currentApp.scaleAnimate(),e.close()},function(t){e.tabInfoErrorRowHandler.find("p").text(t),e.tabInfoErrorRowHandler.addClass("show"),setTimeout(function(){e.tabInfoErrorRowHandler.removeClass("show")},3e3)},"text")}),this.reset=function(){this.currentApp=null,this.relatedCatalogApp=null,e.resetSimpleInputs(),e.resetSameAccountsRow(),this.resetSignInAccounts(),e.resetPasswordShows(),e.lockPasswordInput(e.passwordInputDiv),this.qRoot.find(".row.fragmentsRow").tabs("option","active",0),e.tabDeleteErrorRowHandler.removeClass("show"),e.tabInfoErrorRowHandler.removeClass("show"),e.signInChooseRow.addClass("hide"),e.urlRow.addClass("hide"),e.urlInputHandler.val(""),e.signInAccountSelectRow.addClass("hide"),e.loginPasswordRow.addClass("hide"),e.sameSsoAppsRow.addClass("hide"),e.resetInputs()},this.initializeCurrentInputs=function(){for(var t=0;t<e.relatedCatalogApp.inputs.length;t++){var n=e.relatedCatalogApp.inputs[t],s=e.currentApp.getAccountInformationValue(n.name);e.currentInputs.push(new EditInput(e.loginPasswordRow,e,n.name,n.type,s,n.placeholder,n.placeholderIcon))}$("input",e.loginPasswordRow).on("input",e.checkInputs)},this.checkInputs=function(){for(var t=0;t<e.currentInputs.length;t++){var n=e.currentInputs[t];if(!n.inputField.parent().hasClass("locked")&&!n.val().length)return void e.tabInfoSubmitButton.addClass("locked")}e.tabInfoSubmitButton.removeClass("locked")},this.resetInputs=function(){$(".input",e.loginPasswordRow).remove(),e.currentInputs=[]},this.open=function(t){if(currentEasePopup=e,e.reset(),this.currentApp=t,e.appNameHolder.val(t.name),e.relatedCatalogApp=catalog.getAppById(t.websiteId),void 0!=e.relatedCatalogApp&&e.initializeCurrentInputs(),t.isEmpty)e.unlockPasswordInput($("span.input.password")),e.relatedCatalogApp.canLoginWith.length&&(e.showSignInButtons(e.relatedCatalogApp.canLoginWith),e.signInChooseRow.removeClass("hide")),e.loginPasswordRow.removeClass("hide");else if(t.url.length)e.urlInputHandler.val(t.url),e.urlRow.removeClass("hide");else if(t.logWith.length){e.showSignInButtons(e.relatedCatalogApp.canLoginWith),e.signInChooseRow.removeClass("hide"),e.basicSignInName=catalog.getAppById(easeAppsManager.getAppById(t.logWith).websiteId).name;for(var n=0;n<e.signInButtons.length;n++)if(e.signInButtons[n].name==e.basicSignInName){e.signInButtons[n].qRoot.click();break}}else e.currentInputs.length&&e.loginPasswordRow.removeClass("hide");t.isEmpty||t.url.length||-1==t.ssoId||(e.setupSameSsoAccountsDiv(),e.sameSsoAccountsVar.length&&e.sameSsoAppsRow.removeClass("hide")),e.appLogoHandler.attr("src",t.logoHandler.attr("src")),e.parentHandler.addClass("myshow"),e.qRoot.addClass("show")},this.close=function(){e.qRoot.removeClass("show"),e.parentHandler.removeClass("myshow")},this.goBackButtonHandler.click(function(){e.close()})};var easeModifyAppPopup;$(document).ready(function(){easeModifyAppPopup=new modifyAppPopup($("#modifyAppPopup"))});